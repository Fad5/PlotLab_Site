{% extends "analysis/base.html" %}
{% load static %}

{% block page_title %}Разрыв пластика - трёхточечный изгиб{% endblock %}

{% block content %}
<div class="container">
    <div class="form-container">
        <h1>Разрыв пластика - трёхточечный изгиб</h1>
        
        <!-- Форма загрузки файлов -->
        <form method="post" enctype="multipart/form-data">
            {% csrf_token %}
            
            <div class="form-group">
                <label for="data_archive">Архив с данными испытаний (.zip):</label>
                <input class="form-control-file" type="file" name="data_archive" id="data_archive" accept=".zip" required>
                <small class="form-text text-muted">
                    ZIP-архив должен содержать файлы данных в формате .txt с результатами испытаний на разрыв.
                    Имя файла будет использовано как название образца (например: Образец_1.txt).
                </small>
            </div>
            
            <!-- Кнопка отправки -->
            <button type="submit" class="download-btn">
                <i class="fas fa-cogs"></i> Анализировать данные
            </button>
        </form>
        
        <hr class="br_">
    </div>
</div>

<h1>Инструкция: </h1>

<h2>1. Подготовка файлов</h2>

<div class="requirement">
    <h3>Требования к данным испытаний на разрыв:</h3>
    <ul>
        <li>Файлы данных должны быть в формате .txt</li>
        <li>Должны содержать 4 колонки:
            <ol>
                <li>1-я колонка: Сила (Н)</li>
                <li>2-я колонка: (не используется)</li>
                <li>3-я колонка: Перемещение (мм)</li>
                <li>4-я колонка: Время (с)</li>
            </ol>
        </li>
        <li>Десятичный разделитель - запятая</li>
        <li>Все файлы должны быть упакованы в ZIP-архив</li>
        <li>Имена файлов будут использованы как названия образцов:
            <br><code>Образец_1.txt</code> → образец "Образец_1"</li>
    </ul>
</div>

<div class="note">
    <strong>Пример структуры файла данных:</strong>
    <div class="code">
        Сила(Н), , Перемещение(мм), Время(с)<br>
        0.00, , 0.00, 0.00<br>
        10.54, , 0.42, 1.27<br>
        20.54, , 0.56, 1.70<br>
        30.65, , 0.73, 2.20<br>
        ...<br>
        85.38, , 1.00, 3.02<br>
        0.00, , 1.01, 3.05<br>
    </div>
</div>

<h2>2. Процесс работы</h2>

<div class="process-step">
    <div class="step-number">1</div>
    <div class="step-content">
        <strong>Загрузка архива</strong>
        <p>На странице анализа:</p>
        <ol>
            <li>Выберите ZIP-архив с файлами данных (.txt)</li>
            <li>Нажмите кнопку "Анализировать данные"</li>
        </ol>
    </div>
</div>

<div class="process-step">
    <div class="step-number">2</div>
    <div class="step-content">
        <strong>Обработка данных системой</strong>
        <p>Система выполняет следующие действия (аналог MATLAB-скрипта):</p>
        <ul>
            <li>Распаковывает архив и извлекает файлы данных</li>
            <li>Для каждого файла данных:
                <ul>
                    <li>Читает данные из столбцов: 1 (сила), 3 (перемещение), 4 (время)</li>
                    <li>Удаляет начальные нулевые значения силы</li>
                    <li>Фильтрует данные: force > 0 и displacement >= 0</li>
                    <li>Находит максимальную силу и соответствующее перемещение</li>
                    <li>Строит графики:
                        <ul>
                            <li>График "Сила-Время-Перемещение"</li>
                            <li>График "Сила-Перемещение"</li>
                        </ul>
                    </li>
                    <li>Отмечает точку максимальной нагрузки</li>
                </ul>
            </li>
            <li>Создает Excel-файл с результатами</li>
        </ul>
    </div>
</div>

<div class="process-step">
    <div class="step-number">3</div>
    <div class="step-content">
        <strong>Формирование результата</strong>
        <p>После обработки всех данных:</p>
        <ul>
            <li>Для каждого образца создается папка с именем файла</li>
            <li>В каждой папке сохраняются:
                <ul>
                    <li>График "Сила-Время-Перемещение" (.png)</li>
                    <li>График "Сила-Перемещение" (.png)</li>
                    <li>Excel-файл с результатами расчетов</li>
                </ul>
            </li>
            <li>Все результаты упаковываются в ZIP-архив</li>
            <li>Архив автоматически загружается на ваш компьютер</li>
        </ul>
    </div>
</div>

<h2>3. Пример результатов</h2>

<div class="note">
    <strong>Пример выходной структуры архива:</strong>
    <div class="code">
        tensile_test_results.zip/<br>
        ├── Образец_1/<br>
        │   ├── Образец_1_время.png<br>
        │   ├── Образец_1_нагрузка_перемещение.png<br>
        │   └── Образец_1_результаты.xlsx<br>
        ├── Образец_2/<br>
        │   ├── Образец_2_время.png<br>
        │   ├── Образец_2_нагрузка_перемещение.png<br>
        │   └── Образец_2_результаты.xlsx<br>
        └── СВОДНЫЙ_РЕЗУЛЬТАТЫ.xlsx
    </div>
</div>

<div class="note">
    <strong>Содержимое Excel-файла результатов:</strong>
    <ul>
        <li>Максимальная сила разрушения (Н)</li>
        <li>Перемещение в момент максимальной силы (мм)</li>
        <li>Время достижения максимальной силы (с)</li>
        <li>Основные статистические параметры</li>
    </ul>
</div>

<h2>4. Ограничения и рекомендации</h2>

<div class="requirement">
    <ul>
        <li>Максимальное количество файлов в архиве: 50</li>
        <li>Максимальный размер архива: 100 МБ</li>
        <li>Рекомендуемая частота данных: не менее 10 Гц</li>
        <li>Данные должны содержать четко выраженный пик силы (точку разрушения)</li>
        <li>Файлы должны иметь расширение .txt</li>
    </ul>
</div>

<script>
    // Проверка выбора файлов перед отправкой
    document.querySelector('form').addEventListener('submit', function(e) {
        const dataArchive = document.getElementById('data_archive');
        
        if (!dataArchive.files[0]) {
            e.preventDefault();
            alert('Пожалуйста, выберите архив с данными перед отправкой формы.');
        }
    });
</script>
{% endblock %}