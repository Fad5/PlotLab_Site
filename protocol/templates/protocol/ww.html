{% extends "analysis/base.html" %}
{% load static %}

{% block page_title %}Вибрационные испытания - анализ циклов{% endblock %}

{% block content %}
<div class="container">
    <div class="form-container">
        <h1>Вибрационные испытания - анализ циклов</h1>
        
        <!-- Форма загрузки файлов -->
        <form method="post" enctype="multipart/form-data">
            {% csrf_token %}
            
            <div class="form-group">
                <label for="data_archive">Архив с данными испытаний (.zip):</label>
                <input class="form-control-file" type="file" name="data_archive" id="data_archive" accept=".zip" required>
                <small class="form-text text-muted">
                    ZIP-архив должен содержать файлы данных в формате .txt с результатами испытаний.
                    Имя файла будет использовано как название образца (например: РМВИ-Тип2(1).txt).
                </small>
            </div>
            
            <!-- Кнопка отправки -->
            <button type="submit" class="download-btn">
                <i class="fas fa-cogs"></i> Анализировать данные
            </button>
        </form>
        
        <hr class="br_">
    </div>
</div>

<h1>Инструкция: </h1>

<h2>1. Подготовка файлов</h2>

<div class="requirement">
    <h3>Требования к данным испытаний:</h3>
    <ul>
        <li>Файлы данных должны быть в формате .txt</li>
        <li>Должны содержать 4 колонки:
            <ol>
                <li>1-я колонка: Сила (Н)</li>
                <li>2-я колонка: (не используется)</li>
                <li>3-я колонка: Перемещение (мм)</li>
                <li>4-я колонка: Время (с)</li>
            </ol>
        </li>
        <li>Десятичный разделитель - запятая</li>
        <li>Все файлы должны быть упакованы в ZIP-архив</li>
        <li>Имена файлов будут использованы как названия образцов:
            <br><code>РМВИ-Тип2(1).txt</code> → образец "РМВИ-Тип2(1)"</li>
    </ul>
</div>

<div class="note">
    <strong>Пример структуры файла данных:</strong>
    <div class="code">
        Сила(Н), , Перемещение(мм), Время(с)<br>
        0, , 0, 0<br>
        0.1, , 0.05, 0.1<br>
        0.5, , 0.15, 0.2<br>
        ...<br>
        10.5, , 2.5, 5.0<br>
        0, , 2.6, 5.1
    </div>
</div>

<h2>2. Процесс работы</h2>

<div class="process-step">
    <div class="step-number">1</div>
    <div class="step-content">
        <strong>Загрузка архива</strong>
        <p>На странице анализа:</p>
        <ol>
            <li>Выберите ZIP-архив с файлами данных (.txt)</li>
            <li>Нажмите кнопку "Анализировать данные"</li>
        </ol>
    </div>
</div>

<div class="process-step">
    <div class="step-number">2</div>
    <div class="step-content">
        <strong>Обработка данных системой</strong>
        <p>Система выполняет следующие действия:</p>
        <ul>
            <li>Распаковывает архив и извлекает файлы данных</li>
            <li>Для каждого файла данных (как в MATLAB-скрипте):
                <ul>
                    <li>Удаляет начальные нулевые значения</li>
                    <li>Определяет циклы нагружения</li>
                    <li>Рассчитывает жесткость для каждого цикла</li>
                    <li>Строит графики:
                        <ul>
                            <li>График "Сила-Время-Перемещение"</li>
                            <li>График "Сила-Перемещение" для всех циклов</li>
                            <li>Выделяет 4-й цикл (или последний) для анализа</li>
                        </ul>
                    </li>
                </ul>
            </li>
            <li>Создает Excel-файл с результатами</li>
        </ul>
    </div>
</div>

<div class="process-step">
    <div class="step-number">3</div>
    <div class="step-content">
        <strong>Формирование результата</strong>
        <p>После обработки всех данных:</p>
        <ul>
            <li>Для каждого образца создается папка с именем файла</li>
            <li>В каждой папке сохраняются:
                <ul>
                    <li>График "Сила-Время-Перемещение" (.png)</li>
                    <li>График "Сила-Перемещение" (.png)</li>
                    <li>Excel-файл с результатами расчетов</li>
                </ul>
            </li>
            <li>Все результаты упаковываются в ZIP-архив</li>
            <li>Архив автоматически загружается на ваш компьютер</li>
        </ul>
    </div>
</div>

<h2>3. Пример результатов</h2>

<div class="note">
    <strong>Пример выходной структуры архива:</strong>
    <div class="code">
        vibration_results.zip/<br>
        ├── РМВИ-Тип2(1)/<br>
        │   ├── РМВИ-Тип2(1)_time_plot.png<br>
        │   ├── РМВИ-Тип2(1)_cycles_plot.png<br>
        │   └── РМВИ-Тип2(1)_results.xlsx<br>
        ├── РМВИ-Тип2(2)/<br>
        │   ├── РМВИ-Тип2(2)_time_plot.png<br>
        │   ├── РМВИ-Тип2(2)_cycles_plot.png<br>
        │   └── РМВИ-Тип2(2)_results.xlsx<br>
        └── СВОДНЫЙ_РЕЗУЛЬТАТЫ.xlsx
    </div>
</div>

<div class="note">
    <strong>Содержимое Excel-файла результатов:</strong>
    <ul>
        <li>Лист "Результаты циклов": таблица с расчетами жесткости для каждого цикла</li>
        <li>Лист "Целевой цикл": подробная информация о 4-м цикле (или последнем)</li>
    </ul>
</div>

<h2>4. Ограничения и рекомендации</h2>

<div class="requirement">
    <ul>
        <li>Максимальное количество файлов в архиве: 50</li>
        <li>Максимальный размер архива: 100 МБ</li>
        <li>Рекомендуемая частота данных: не менее 10 Гц</li>
        <li>Минимальное количество точек в цикле: 10</li>
        <li>Для корректного определения циклов должны быть четко выраженные пики нагрузки</li>
        <li>Файлы должны иметь расширение .txt</li>
    </ul>
</div>

<script>
    // Проверка выбора файлов перед отправкой
    document.querySelector('form').addEventListener('submit', function(e) {
        const dataArchive = document.getElementById('data_archive');
        
        if (!dataArchive.files[0]) {
            e.preventDefault();
            alert('Пожалуйста, выберите архив с данными перед отправкой формы.');
        }
    });
</script>
{% endblock %}