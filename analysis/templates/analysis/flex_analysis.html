{% extends "analysis/base.html" %}
{% load static %}

{% block page_title %}–ò—Å–ø—ã—Ç–∞–Ω–∏–µ –Ω–∞ –∏–∑–≥–∏–±{% endblock %}

{% block style %}
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<style>
  .glass-container {
    background: var(--box-bg);
    border-radius: 20px;
    border: 1px solid rgba(255, 255, 255, 0.2);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.25);
    backdrop-filter: blur(10px);
    width: 90%;
    max-width: 1200px;
    padding: 2rem;
    margin-bottom: 2rem;
  }

  
  
  .input-sample{
    border: solid 3px var(--text-color);
    background: var(--input-bg);
    color: var(--text-color);
    width: 100%;
    padding: 8px;
    border-radius: 8px;
    }

  .fileform { 
    background-color: #FFFFFF;
    border: 1px solid #CCCCCC;
    border-radius: 2px;
    cursor: pointer;
    height: 26px;
    overflow: hidden;
    padding: 2px;
    position: relative;
    text-align: left;
    vertical-align: middle;
    width: 230px;
  }
  
  .results-container {
    margin-top: 2rem;
    border-radius: 20px;
    padding: 1.5rem;
  }
  .upload-section {
    display: flex;
    flex-direction: column;
    align-items: center;
    margin-bottom: 2rem;
  }
  
  .results-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 1rem;
    margin-top: 1rem;
  }
  
  .result-item {
    background: rgba(255, 255, 255, 0.1);
    padding: 1rem;
    border-radius: 10px;
    border-left: 4px solid var(--accent-color);
  }
  label {
    display: block;
    margin-bottom: 5px;
    font-weight: bold;
  }
  .result-value {
    font-size: 1.2rem;
    font-weight: bold;
    color: var(--accent-color);
  }

  .parameter-group {
    display: flex;
    flex-direction: column;
    min-width: 200px;
  }

  .name-methodology{
    text-align: center;
  }

  .parameter-table th, .parameter-table td {
    border: 1px solid  var(--text-color);
    padding: 8px;
    text-align: left;
  }

  .parameter-table{
    width: 100%;
    border-collapse: collapse;
    margin: 15px 0;
  }
  
  .center-text{
    text-align: center;
  }
  .parameters-section {
    display: flex
;
    flex-wrap: wrap;
    gap: 1rem;
    justify-content: center;
    margin-bottom: 1.5rem;}
  
  @media (max-width: 768px) {
    .results-grid {
      grid-template-columns: 1fr;
    }
  }
</style>
{% endblock %}
{% block content %}
<div class="container">
    <h2 class="center-text">–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –æ–±—Ä–∞–∑—Ü–∞</h2>
    
    <form method="post" enctype="multipart/form-data" class="mb-4">
        {% csrf_token %}





        <div class="parameters-section">
            <div class="parameter-group">
                <label class="form-label">–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É –æ–ø–æ—Ä–∞–º–∏ L (–º–º)</label>
                <input class="input-sample" type="number" step="0.1" name="L" value="64" class="form-control">
            </div>
            <div class="parameter-group">
                <label class="form-label">–®–∏—Ä–∏–Ω–∞ –æ–±—Ä–∞–∑—Ü–∞ b (–º–º)</label>
                <input class="input-sample" type="number" step="0.1" name="b" value="10" class="form-control">
            </div>
            <div class="parameter-group">
                <label class="form-label">–¢–æ–ª—â–∏–Ω–∞ –æ–±—Ä–∞–∑—Ü–∞ h (–º–º)</label>
                <input class="input-sample" type="number" step="0.1" name="h" value="4" class="form-control">
            </div>
        </div>
        

      <div class="upload-section">
              <label><strong>üìÅ –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª —Å –¥–∞–Ω–Ω—ã–º–∏ (TXT):</strong></label>
            <label for="csvFile" class="btn-download">üìÅ –í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª—ã</label>
            <input class="input-file" type="file" name="data_file" id="csvFile" accept=".txt" value="{{ filename.filename}}" required />
            <button type="submit">–ü–æ—Å—Ç—Ä–æ–∏—Ç—å –≥—Ä–∞—Ñ–∏–∫–∏</button>
       </div>
    </form>
    
    {% if error %}
        <div class="alert alert-danger">{{ error }}</div>
    {% endif %}
    
    {% if chart_data %}
    <div class="result-card">
        <h4>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–Ω–∞–ª–∏–∑–∞</h4>
        <p>–ú–æ–¥—É–ª—å —É–ø—Ä—É–≥–æ—Å—Ç–∏ –ø—Ä–∏ –∏–∑–≥–∏–±–µ: <strong>{{ results.elastic_modulus }} –ì–ü–∞</strong></p>
        
        <div class="row">
            <div class="col-md-6">
                <div id="stressStrainChart" class="chart-container"></div>
            </div>
            <div class="col-md-6">
                <div id="forceDisplacementChart" class="chart-container"></div>
            </div>
        </div>
    </div>
     {% endif %}

<div class="methodology-card">
  <h2 class="center-text">–ú–µ—Ç–æ–¥–∏–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ —Ç—Ä–µ—Ö—Ç–æ—á–µ—á–Ω–æ–≥–æ –∏–∑–≥–∏–±–∞ –ø–æ –ì–û–°–¢ 4648-2014</h2>
  
  <div class="formula-container">
    <h4>1. –†–∞—Å—á–µ—Ç –Ω–∞–ø—Ä—è–∂–µ–Ω–∏—è –ø—Ä–∏ –∏–∑–≥–∏–±–µ:</h4>
    \[ \sigma_f = \frac{3 \cdot F \cdot L}{2 \cdot b \cdot h^2} \]
    <p>–≥–¥–µ:</p>
<table class="parameter-table">
    <tr>
        <th>–°–∏–º–≤–æ–ª</th>
        <th>–ü–∞—Ä–∞–º–µ—Ç—Ä</th>
        <th>–ï–¥–∏–Ω–∏—Ü—ã –∏–∑–º–µ—Ä–µ–Ω–∏—è</th>
    </tr>
    <tr>
        <th>R<sub>m</sub></th>
        <td>–ü—Ä–µ–¥–µ–ª –ø—Ä–æ—á–Ω–æ—Å—Ç–∏ –ø—Ä–∏ —Ä–∞—Å—Ç—è–∂–µ–Ω–∏–∏</td>
        <td>–ú–ü–∞</td>
    </tr>
    <tr>
        <th>R<sub>p0.2</sub></th>
        <td>–ü—Ä–µ–¥–µ–ª —Ç–µ–∫—É—á–µ—Å—Ç–∏ (—É—Å–ª–æ–≤–Ω—ã–π)</td>
        <td>–ú–ü–∞</td>
    </tr>
    <tr>
        <th>E</th>
        <td>–ú–æ–¥—É–ª—å —É–ø—Ä—É–≥–æ—Å—Ç–∏</td>
        <td>–ì–ü–∞</td>
    </tr>
    <tr>
        <th>Œµ<sub>r</sub></th>
        <td>–û—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ–µ —É–¥–ª–∏–Ω–µ–Ω–∏–µ –ø—Ä–∏ —Ä–∞–∑—Ä—ã–≤–µ</td>
        <td>%</td>
    </tr>
    <tr>
        <th>A<sub>0</sub></th>
        <td>–ù–∞—á–∞–ª—å–Ω–∞—è –ø–ª–æ—â–∞–¥—å —Å–µ—á–µ–Ω–∏—è –æ–±—Ä–∞–∑—Ü–∞</td>
        <td>–º–º¬≤</td>
    </tr>
    <tr>
        <th>L<sub>0</sub></th>
        <td>–ù–∞—á–∞–ª—å–Ω–∞—è —Ä–∞—Å—á–µ—Ç–Ω–∞—è –¥–ª–∏–Ω–∞ –æ–±—Ä–∞–∑—Ü–∞</td>
        <td>–º–º</td>
    </tr>
</table>

  <div class="formula-container">
    <h4>2. –†–∞—Å—á–µ—Ç –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ–π –¥–µ—Ñ–æ—Ä–º–∞—Ü–∏–∏:</h4>
    \[ \varepsilon_f = \frac{6 \cdot s \cdot h}{L^2} \]
    <p>–≥–¥–µ \( s \) - –ø—Ä–æ–≥–∏–± –æ–±—Ä–∞–∑—Ü–∞ (–º–º)</p>
  </div>

  <div class="formula-container">
    <h4>3. –ú–æ–¥—É–ª—å —É–ø—Ä—É–≥–æ—Å—Ç–∏ –ø—Ä–∏ –∏–∑–≥–∏–±–µ:</h4>
    \[ E_f = \frac{\sigma_{f2} - \sigma_{f1}}{\varepsilon_{f2} - \varepsilon_{f1}} \]
    <p>–≥–¥–µ –∏–Ω–¥–µ–∫—Å—ã 1 –∏ 2 —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –¥–≤—É–º —Ç–æ—á–∫–∞–º –Ω–∞ –ª–∏–Ω–µ–π–Ω–æ–º —É—á–∞—Å—Ç–∫–µ –¥–∏–∞–≥—Ä–∞–º–º—ã:</p>
    <ul>
      <li>\( \varepsilon_{f1} = 0.0005 \) (0.05%)</li>
      <li>\( \varepsilon_{f2} = 0.0025 \) (0.25%)</li>
    </ul>
  </div>

  <div class="formula-container">
    <h4>4. –ú–µ—Ç–æ–¥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö:</h4>
    <ol>
      <li>–£–¥–∞–ª–µ–Ω–∏–µ –Ω–∞—á–∞–ª—å–Ω–æ–≥–æ —É—á–∞—Å—Ç–∫–∞ (–¥–æ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –Ω–∞–≥—Ä—É–∑–∫–∏ 0.1 –ù)</li>
      <li>–ò–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏—è –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –Ω–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–∏ –∑–∞–¥–∞–Ω–Ω—ã—Ö –¥–µ—Ñ–æ—Ä–º–∞—Ü–∏—è—Ö</li>
      <li>–†–∞—Å—á–µ—Ç –º–æ–¥—É–ª—è —É–ø—Ä—É–≥–æ—Å—Ç–∏ –ø–æ –¥–≤—É–º —Ç–æ—á–∫–∞–º –Ω–∞ –ª–∏–Ω–µ–π–Ω–æ–º —É—á–∞—Å—Ç–∫–µ</li>
    </ol>
  </div>

  <div class="formula-container">
    <h4>5. –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –∏—Å–ø—ã—Ç–∞–Ω–∏—è–º:</h4>
    <ul>
      <li>–°–∫–æ—Ä–æ—Å—Ç—å –Ω–∞–≥—Ä—É–∂–µ–Ω–∏—è: \( 1-2 \text{ –º–º/–º–∏–Ω} \)</li>
      <li>–°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ \( L/h \geq 16 \)</li>
      <li>–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –∏—Å–ø—ã—Ç–∞–Ω–∏—è: \( 23 \pm 2^\circ \text{C} \)</li>
      <li>–û—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–∞—è –≤–ª–∞–∂–Ω–æ—Å—Ç—å: \( 50 \pm 5\% \)</li>
    </ul>
  </div>
</div>


    <script>
        const chartData = JSON.parse('{{ chart_data|escapejs }}');
        
        // Stress-Strain Chart
        Plotly.newPlot('stressStrainChart', [{
            x: chartData.stress_strain.x,
            y: chartData.stress_strain.y,
            mode: 'lines',
            name: '–≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç',
            line: {color: 'blue'}
        }, {
            x: chartData.stress_strain.target_x,
            y: chartData.stress_strain.target_y,
            mode: 'markers+text',
            marker: {size: 10, color: 'red'},
            text: ['E_f = {{ results.elastic_modulus }} –ú–ü–∞', ''],
            textposition: 'top center',
            name: '–¢–æ—á–∫–∏ —Ä–∞—Å—á–µ—Ç–∞'
        }], {
            title: '–ì—Ä–∞—Ñ–∏–∫ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ-–¥–µ—Ñ–æ—Ä–º–∞—Ü–∏—è',
            xaxis: {title: '–û—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–∞—è –¥–µ—Ñ–æ—Ä–º–∞—Ü–∏—è (‚Ä∞)'},
            yaxis: {title: '–ò–∑–≥–∏–±–∞—é—â–µ–µ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ (–ú–ü–∞)'},
            showlegend: true
        });
        
        // Force-Displacement Chart
        Plotly.newPlot('forceDisplacementChart', [{
            x: chartData.force_displacement.x,
            y: chartData.force_displacement.y,
            mode: 'lines',
            name: '–≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç',
            line: {color: 'green'}
        }, {
            x: chartData.force_displacement.target_x,
            y: chartData.force_displacement.target_y,
            mode: 'markers',
            marker: {size: 10, color: 'red'},
            name: '–¢–æ—á–∫–∏ —Ä–∞—Å—á–µ—Ç–∞'
        }], {
            title: '–î–∏–∞–≥—Ä–∞–º–º–∞ —Å–∏–ª–∞-–ø—Ä–æ–≥–∏–±',
            xaxis: {title: '–ü—Ä–æ–≥–∏–± (–º–º)'},
            yaxis: {title: '–°–∏–ª–∞ (–ù)'},
            showlegend: true
        });
    </script>
</div>
{% endblock %}